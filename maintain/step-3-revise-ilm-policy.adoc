---
permalink: maintain/step-3-revise-ilm-policy.html 
sidebar: sidebar 
keywords: storagegrid, recover, revise ilm policy 
summary: 運用停止サイトウィザードの手順 3 （ ILM ポリシーの改訂）から、サイトがアクティブな ILM ポリシーで参照されているかどうかを確認できます。 
---
= 手順 3 ： ILM ポリシーを改訂する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
運用停止サイトウィザードの手順 3 （ ILM ポリシーを改訂）から、サイトがアクティブな ILM ポリシーで参照されているかどうかを確認できます。

.作業を開始する前に
ILMの仕組みを十分に理解し、ストレージプール、イレイジャーコーディングプロファイル、ILMルールの作成、ILMポリシーのシミュレートとアクティブ化に精通している。を参照してください link:../ilm/index.html["ILM を使用してオブジェクトを管理する"]。

.このタスクについて
StorageGRID は、そのサイトがアクティブなILMポリシー内のILMルールで参照されている場合、そのサイトの運用を停止できません。

現在の ILM ポリシーが削除するサイトを参照している場合は、特定の要件を満たす新しい ILM ポリシーをアクティブ化する必要があります。具体的には、新しい ILM ポリシー：

* サイトを参照しているストレージプールや[すべてのサイト]オプションを使用しているストレージプールは使用できません。
* サイトを参照するイレイジャーコーディングプロファイルは使用できません。
* StorageGRID 11.6以前のインストールでは、Make 2 Copiesルールを使用できません。
* すべてのオブジェクトデータを完全に保護するように設計する必要があります。
+

IMPORTANT: サイトの削除に対応するためにシングルコピーの ILM ルールを作成しないでください。ある期間にレプリケートコピーを 1 つしか作成しない ILM ルールには、データが永続的に失われるリスクがあります。オブジェクトのレプリケートコピーが 1 つしかない場合、ストレージノードに障害が発生したり、重大なエラーが発生すると、そのオブジェクトは失われます。また、アップグレードなどのメンテナンス作業中は、オブジェクトへのアクセスが一時的に失われます。



_connected サイトの運用停止 _ を実行する場合は、削除するサイトに現在あるオブジェクトデータを StorageGRID でどのように管理するかを検討する必要があります。データ保護要件に応じて、新しいルールによって既存のオブジェクトデータを別のサイトに移動したり、不要になったオブジェクトコピーを削除したりできます。

新しいポリシーの設計でサポートが必要な場合は、テクニカルサポートにお問い合わせください。

.手順
. 手順 3 （ ILM ポリシーの改訂）で、アクティブな ILM ポリシー内の ILM ルールが削除対象として選択したサイトを参照しているかどうかを確認します。
. ルールがリストされていない場合は、*[次へ]*を選択してに進みます link:step-4-remove-ilm-references.html["手順 4 ： ILM 参照を削除する"]。
. テーブルに ILM ルールが 1 つ以上表示されている場合は、アクティブポリシー名 * の横のリンクを選択します。
+
ブラウザの新しいタブに[ILM policies]ページが表示されます。このタブを使用して ILM を更新します。[Decommission Site] ページは、 [other] タブに表示されたままになります。

+
.. 必要に応じて、* ILM *>* Storage pools *を選択して、サイトを参照していないストレージプールを1つ以上作成します。
+

NOTE: 詳細については、情報ライフサイクル管理を使用してオブジェクトを管理する手順を参照してください。

.. イレイジャーコーディングを使用する場合は、* ILM *>*イレイジャーコーディング*を選択して1つ以上のイレイジャーコーディングプロファイルを作成します。
+
サイトを参照していないストレージプールを選択する必要があります。

+

NOTE: イレイジャーコーディングプロファイルで* All Storage Nodes *ストレージプール（StorageGRID 11.6以前）を使用しないでください。



. * ILM * > * Rules * を選択し、手順 3 （ ILM ポリシーの改訂）の表に記載された各ルールをクローニングします。
+

NOTE: 詳細については、情報ライフサイクル管理を使用してオブジェクトを管理する手順を参照してください。

+
.. 新しいポリシーでこれらのルールを簡単に選択できるように、名前を使用します。
.. 配置手順を更新します。
+
サイトを参照しているストレージプールまたはイレイジャーコーディングプロファイルをすべて削除し、新しいストレージプールまたはイレイジャーコーディングプロファイルに置き換えます。

+

NOTE: 新しいルールでは* All Storage Nodes *ストレージプールを使用しないでください。



. 「 * ILM * > * Policies * 」を選択し、新しいルールを使用する新しいポリシーを作成します。
+

NOTE: 詳細については、情報ライフサイクル管理を使用してオブジェクトを管理する手順を参照してください。

+
.. アクティブなポリシーを選択し、 * Clone * を選択します。
.. ポリシー名と変更理由を指定してください。
.. クローニングしたポリシーのルールを選択します。
+
*** [Decommission Site]ページの[Step 3（Revise ILM Policy）]に表示されたルールをすべてクリアします。
*** サイトを参照しないデフォルトのルールを選択します。
+

NOTE: このルールでは* All Storage Nodes *ストレージプールを使用しているため、* Make 2 Copies *ルールは選択しないでください。このルールは許可されていません。

*** 作成した他の置換ルールを選択します。これらのルールはサイトを指していない必要があります。
+
image::../media/decommission_site_step_3_cloned_policy.png[運用停止サイトの手順 3 で複製されたポリシー]



.. * 適用 * を選択します。
.. 行をドラッグしてポリシー内のルールの順序を変更します。
+
デフォルトのルールは移動できません。

+

IMPORTANT: ILM ルールの順序が正しいことを確認してください。ポリシーをアクティブ化すると、新規および既存のオブジェクトがリスト内の順にルールによって評価されます。

.. ドラフトポリシーを保存します。


. オブジェクトを取り込み、ドラフトポリシーをシミュレートして正しいルールが適用されることを確認します。
+

CAUTION: 原因 ポリシーにエラーがあると、回復不能なデータ損失が発生する可能性があります。ポリシーをアクティブ化する前によく確認およびシミュレートし、想定どおりに機能することを確認してください。

+

CAUTION: 新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、そのポリシーを使用して、既存のオブジェクトと新たに取り込まれたオブジェクトを含むすべてのオブジェクトを管理します。新しい ILM ポリシーをアクティブ化する前に、既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認してください。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。

. 新しいポリシーをアクティブ化します。
+
接続さ StorageGRID れたサイトの運用停止手順を実行すると、新しい ILM ポリシーをアクティブ化した時点で、選択したサイトからオブジェクトデータの削除が開始されます。すべてのオブジェクトコピーの移動または削除には数週間かかることがあります。サイトにオブジェクトデータが残っている間もサイトの運用停止を安全に開始できますが、実際の運用停止手順 を開始する前にデータをサイトから移動することが許可されている場合は、運用停止手順 の処理がより迅速になり、システム停止やパフォーマンスへの影響も少なくなります （ウィザードの手順 5 で「 * 分解を開始」を選択）。

. 手順 3 （ ILM ポリシーの改訂） * に戻って、新しいアクティブポリシーに ILM ルールがサイトを参照していないこと、および * Next * ボタンが有効になっていることを確認します。
+
image::../media/decommission_site_step_3_no_rules.png[運用停止サイトステップ 3 ルールなし]

+

NOTE: ルールが表示された場合は、続行する前に新しい ILM ポリシーを作成してアクティブ化する必要があります。

. ルールがリストされていない場合は、「 * 次へ * 」を選択します。
+
手順 4 （ Remove ILM References ）が表示されます。


